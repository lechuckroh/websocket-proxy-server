# https://taskfile.dev

version: '3'

vars:
  BINARY: ws-proxy

tasks:
  # install dependencies
  install:
    cmds:
      - go mod vendor

  # build binary
  build:
    cmds:
      - go build -o {{.BINARY}} *.go

  build-darwin-amd64:
    cmds:
      - go build -o {{.BINARY}} *.go
    env:
      CGO_ENABLED: 0
      GO111MODULE: on
      GOARCH: amd64
      GOOS: darwin

  build-darwin-arm64:
    cmds:
      - go build -o {{.BINARY}} *.go
    env:
      CGO_ENABLED: 0
      GO111MODULE: on
      GOARCH: arm64
      GOOS: darwin

  # run
  run:
    deps: [build]
    cmds:
      - ./{{.BINARY}}

  # clear build output
  clean:
    cmds:
      - rm -f {{.BINARY}}

  # run unit test
  test:
    cmds:
      - go test -v ./...